!function($,window,document,undefined){var $window=$(window),$document=$(document),$body=$("body"),Modal={defaults:{addCloseLink:!0,classPrefix:"",closeLinkLabel:"&times;",contentInline:"",contentAjax:"",loadingPlaceholder:'<div class="modal-body">Loading...</div>',maxWidth:"",showImmediately:!1,transitionEndTime:500,type:"id"},init:function(element,options){switch(this.config=$.extend({},this.defaults,options),element!==!1?(this.$element=$(element),this.$element.data("modalLoadingPlaceholder")&&(this.config.loadingPlaceholder=this.$element.data("modalLoadingPlaceholder")),this.$element.data("modalAjax")&&(this.config.type="ajax"),this.$element.data("modalEvent")&&(this.config.type="event"),this.$element.data("modalInline")&&(this.config.type="inline",this.config.contentInline=this.$element.data("modalInline"))):this.$element=!1,this.config.type){case"ajax":case"event":case"inline":this.$modal=this.generateModalMarkup();break;case"id":this.$modal=$("#"+this.$element.data("modal"));break;default:console.error("Invalid modal type")}this.appendBackdrop(),this.setupModal(),this.events(),this.config.showImmediately&&this.openModal()},events:function(){var self=this;this.$element&&this.$element.on("click",function(e){e.preventDefault(),self.openModal()}),this.$modal.on("backdropClose.modal",function(e){self.closeModal()}),this.$closeButtons=this.$modal.find('[data-modal-close="true"]'),this.$closeButtons.on("click",function(e){e.preventDefault(),self.closeModal()})},appendBackdrop:function(){this.$backdrop=$("."+this.config.classPrefix+"modal-backdrop"),0===this.$backdrop.length&&($body.append('<div class="'+this.config.classPrefix+'modal-backdrop"></div>'),this.$backdrop=$("."+this.config.classPrefix+"modal-backdrop"),this.$backdrop.on("click",function(e){$(".modal-active").trigger("backdropClose.modal")}))},closeModal:function(){var self=this;this.$element.length?this.$element.trigger("close.modal"):this.$modal.trigger("close.modal"),this.$backdrop.removeClass(this.config.classPrefix+"modal-active"),this.$modal.removeClass(this.config.classPrefix+"modal-active"),window.setTimeout(function(){self.$modal.addClass(self.config.classPrefix+"modal-inactive"),self.$element.length?self.$element.trigger("closed.modal"):self.$modal.trigger("closed.modal")},this.config.transitionEndTime),this.$modal.css("top","")},generateModalMarkup:function(){var $markup=$("<section></section>"),maxWidthClass=""===this.config.maxWidth?"":this.config.classPrefix+"modal-"+this.config.maxWidth;switch(Date.now||(Date.now=function(){return(new Date).getTime()}),$markup.attr({id:this.config.classPrefix+"modal-"+Date.now(),class:this.config.classPrefix+"modal "+maxWidthClass}),this.config.type){case"ajax":case"event":$markup.html(this.config.loadingPlaceholder);break;case"inline":$markup.html(this.getInlineContent());break;default:console.error("Markup generation failed.")}return $markup},getAjaxContent:function(){if(!this.$element.data("modalAjax"))return!1},getInlineContent:function(){return!!this.config.contentInline.length&&this.config.contentInline},openModal:function(){var self=this,scrollOffset=$document.scrollTop(),initialTopPosition=scrollOffset-100;self.$element.length?self.$element.trigger("open.modal"):self.$modal.trigger("open.modal");var activeModal=$(".modal.modal-active");activeModal.length&&activeModal.each(function(){var swapModal=$(this);swapModal.removeClass(self.config.classPrefix+"modal-active"),window.setTimeout(function(){swapModal.addClass(self.config.classPrefix+"modal-inactive")},self.config.transitionEndTime),swapModal.css("top","")}),this.$modal.css("top",initialTopPosition+"px"),this.$backdrop.addClass(this.config.classPrefix+"modal-active"),this.$modal.removeClass(this.config.classPrefix+"modal-inactive").addClass(this.config.classPrefix+"modal-active"),window.setTimeout(function(){self.$element.length?self.$element.trigger("opened.modal"):self.$modal.trigger("opened.modal")},this.config.transitionEndTime),this.positionModal(),this.updateContent()},positionModal:function(){var scrollOffset=$document.scrollTop(),viewportHeight=$window.height(),modalHeight=this.$modal.height();modalHeight>=viewportHeight?this.$modal.css("top",scrollOffset+20+"px"):modalHeight>viewportHeight/2?this.$modal.css("top",scrollOffset+(viewportHeight-modalHeight)/2+"px"):this.$modal.css("top",scrollOffset+viewportHeight/5+"px")},setupModal:function(){this.$modal.addClass(this.config.classPrefix+"modal-inactive"),$body.append(this.$modal),this.config.addCloseLink&&this.$modal.append('<a href="#" class="'+this.config.classPrefix+'modal-close" data-modal-close="true">'+this.config.closeLinkLabel+"</a>")},updateContent:function(){var self=this,wasUpdated=!1;if("ajax"===this.config.type&&(wasUpdated=!0,this.$modal.html(this.getAjaxContent())),"event"===this.config.type){wasUpdated=!0;var contentUpdateEvent=$.Event("contentUpdate.modal");this.$element.trigger(contentUpdateEvent);var result=String(contentUpdateEvent.result);result.length>0?(this.$modal.html(result),this.config.addCloseLink&&this.$modal.append('<a href="#" class="'+this.config.classPrefix+'modal-close" data-modal-close="true">'+this.config.closeLinkLabel+"</a>")):this.$modal.html('Trigger "contentUpdate" failed.'),self.$closeButtons=self.$modal.find('[data-modal-close="true"]'),self.$closeButtons.on("click",function(e){e.preventDefault(),self.closeModal()})}wasUpdated&&this.positionModal()}};$.fn.modal=function(options){if(this.selector)return this.each(function(){var modal=$.extend({},Modal);modal.init(this,options)});var modal=$.extend({},Modal);modal.init(!1,options)}}(jQuery,window,document);