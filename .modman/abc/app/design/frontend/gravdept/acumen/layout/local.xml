<?xml version="1.0"?>

<!--
/**
* Acumen - Magento Theme
* http://gravitydept.com/to/acumen
*
* @author     Brendan Falkowski
* @package    gravdept_acumen
* @copyright  2010-2016 Gravity Department. All rights reserved.
* @version    2.0.0
*/
-->

<layout version="0.1.0">

<!--
Default layout
-->

    <default>
        <reference name="root">
            <!--
            GravDept:
            See: /template/gravdept/page/catalog-list.phtml
            -->
            <block type="core/text_list" name="gravdept.catalog.header" as="gravdept_catalog_header" />
        </reference>

        <reference name="head">
            <!--
            GravDept:
            Some assets are not loaded via XML files.
            See: /template/page/html/head.phtml
            See: CMS blocks
            See: "before_body_end" block
            -->

            <!-- GravDept: add viewport meta tag -->
            <block type="core/template" name="gravdept.page.html.meta-viewport" as="meta_viewport" template="gravdept/page/html/meta-viewport.phtml" />

            <!--
            GravDept:
            Generated by Gulp (scripts required in <head>).
            See: /skin/.../js/build/module-app-pre.min.js

            Execution order is forced before Magento assembles <head> scripts.
            See: /page/html/head.phtml
            -->
        </reference>

        <reference name="after_body_start">
            <!--
            GravDept:
            Custom block for IE8 warning.
            -->
            <block type="core/template" name="gravdept.page.html.browser-warning" as="browser_warning" template="gravdept/page/html/browser-warning.phtml" />
        </reference>

        <reference name="header">
            <!--
            GravDept:
            Recreate from the "cart_sidebar" block, which was removed.
            See: checkout.xml
            -->
            <block type="checkout/cart_sidebar" name="checkout.cart.mini" as="mini_cart" before="-" template="checkout/cart/sidebar.phtml">
                <action method="addItemRender"><type>simple</type><block>checkout/cart_item_renderer</block><template>checkout/cart/sidebar/default.phtml</template></action>
                <action method="addItemRender"><type>grouped</type><block>checkout/cart_item_renderer_grouped</block><template>checkout/cart/sidebar/default.phtml</template></action>
                <action method="addItemRender"><type>configurable</type><block>checkout/cart_item_renderer_configurable</block><template>checkout/cart/sidebar/default.phtml</template></action>
                <block type="core/text_list" name="cart_sidebar.extra_actions" as="extra_actions" translate="label" module="checkout">
                    <label>Shopping Cart Sidebar Extra Actions</label>
                </block>
            </block>

            <!--
            GravDept:
            Custom block to show cart quantity.
            This block is actually rendered twice in "header.phtml" (for design purposes).
            This block is hole-punched for EE caching.
            -->
            <block type="gravdept_checkout/cart_counter" name="gravdept.checkout.cart.counter" as="cart_counter" template="gravdept/checkout/cart/counter.phtml" />

            <!--
            GravDept:
            User Account.
            This block is hole-punched for EE caching.
            -->
            <block type="page/template_links" name="account.links" as="header_account" template="gravdept/page/html/account-menu.phtml" />
        </reference>

        <reference name="footer">
            <!--
            GravDept:
            Add "featured product".
            -->
            <block type="core/template" name="gravdept.ui.featuredProduct" as="featured_product" template="gravdept/ui/featured-product.phtml">
                <action method="setData">
                    <key>category_id</key>
                    <value>3</value>
                </action>

                <action method="setData">
                    <key>title</key>
                    <value>Weekly Pick</value>
                </action>
            </block>
        </reference>

        <reference name="before_body_end">
            <block type="core/template" name="gravdept.page.html.site-overlay" template="gravdept/page/html/site-overlay.phtml" />

            <!--
            GravDept:
            Load JS package generated by Gulp.
            -->
            <block type="core/template" name="gravdept.js.app-post" before="-" template="gravdept/js/app-post.phtml" />

            <!--
            GravDept:
            Add translations for JS.
            -->
            <block type="core/template" name="gravdept.page.html.translate" after="-" template="/gravdept/page/html/translate.phtml" />
        </reference>

        <!-- GravDept: see "catalog.xml" -->
        <action method="unsetChild">
            <alias>catalog.compare.sidebar</alias>
        </action>

        <!--
        *************************************************
        GravDept
        Remove these Magento blocks globally.
        *************************************************
        -->

        <!--
        GravDept:
        Remove Magento's cart top links.
        Recreate this manually in "header" block.
        See: checkout.xml
        -->
        <remove name="checkout_cart_link" />

        <!--
        GravDept:
        Remove Magento's sidebar cart.
        Recreate this as "checkout.cart.mini" in "header" block.
        See: checkout.xml
        -->
        <remove name="cart_sidebar" />

        <!-- GravDept: cms.xml -->
        <remove name="cms_footer_links" />

        <!-- GravDept: page.xml -->
        <remove name="top.links" />
        <remove name="footer_links" />

        <!-- GravDept: poll.xml -->
        <remove name="right.poll" />

        <!-- GravDept: reports.xml -->
        <remove name="right.reports.product.compared" />
        <remove name="right.reports.product.viewed" />
    </default>

<!--
User States
-->

    <customer_logged_in>
        <remove name="sale.reorder.sidebar" />
    </customer_logged_in>

<!--
Module layouts
-->

    <catalog_category_default>
        <reference name="before_body_end">
            <!-- GravDept -->
            <block type="core/template" name="gravdept.js.module-catalog" after="-" template="gravdept/js/catalog.phtml" />
        </reference>
    </catalog_category_default>

    <catalog_category_layered>
        <reference name="root">
            <!-- GravDept: insert the compare sidebar -->
            <block type="catalog/product_compare_sidebar" name="catalog.compare.sidebar" as="compare_sidebar" template="catalog/product/compare/sidebar.phtml" />
        </reference>

        <reference name="before_body_end">
            <!-- GravDept -->
            <block type="core/template" name="gravdept.js.module-catalog" after="-" template="gravdept/js/catalog.phtml" />
        </reference>
    </catalog_category_layered>

    <catalog_category_layered_nochildren>
        <!-- GravDept: reports.xml -->
        <remove name="left.reports.product.viewed" />

        <reference name="before_body_end">
            <!-- GravDept -->
            <block type="core/template" name="gravdept.js.module-catalog" after="-" template="gravdept/js/catalog.phtml" />
        </reference>
    </catalog_category_layered_nochildren>

    <catalog_product_view>
        <reference name="head">
            <!-- GravDept: remove unused stylesheet -->
            <action method="removeItem">
                <type>js_css</type>
                <name>calendar/calendar-win2k-1.css</name>
            </action>

            <!-- GravDept: remove unused scripts -->
            <action method="removeItem">
                <type>js</type>
                <name>calendar/calendar.js</name>
            </action>

            <!-- GravDept: remove unused scripts -->
            <action method="removeItem">
                <type>js</type>
                <name>calendar/calendar-setup.js</name>
            </action>
        </reference>

        <reference name="before_body_end">
            <!-- GravDept: add PhotoSwipe HTML -->
            <block type="core/template" name="gravdept.catalog.product.view.photoswipe" template="/gravdept/catalog/product/view/photoswipe.phtml" />

            <!-- GravDept: add custom JS -->
            <block type="core/template" name="gravdept.js.module-product" after="-" template="gravdept/js/product.phtml" />
        </reference>

        <!-- GravDept: remove garish PayPal buttons -->
        <remove name="product.info.addtocart.paypal.wrapper" />
    </catalog_product_view>

    <catalogsearch_result_index>
        <reference name="root">
            <!-- GravDept -->
            <action method="setTemplate">
                <template>gravdept/page/catalog-list.phtml</template>
            </action>

            <!-- GravDept: insert the compare sidebar -->
            <block type="catalog/product_compare_sidebar" name="catalog.compare.sidebar" as="compare_sidebar" template="catalog/product/compare/sidebar.phtml" />
        </reference>

        <!-- GravDept -->
        <reference name="gravdept.catalog.header">
            <!-- GravDept: note the "type" matched from parent block in "content" reference -->
            <block type="catalogsearch/result" name="gravdept.catalogsearch.header" template="gravdept/catalogsearch/header.phtml"/>
        </reference>

        <reference name="left">
            <!-- GravDept: hide -->
            <!--<block type="catalogsearch/term" name="seo.searchterm" after="catalogsearch.leftnav" template="catalogsearch/term.phtml" />-->
        </reference>

        <reference name="before_body_end">
            <!-- GravDept -->
            <block type="core/template" name="gravdept.js.module-catalog" after="-" template="gravdept/js/catalog.phtml" />
        </reference>
    </catalogsearch_result_index>

    <checkout_cart_index>
        <reference name="head">
            <!-- GravDept -->
            <action method="setForcedTitle">
                <title>Cart</title>
            </action>
        </reference>

        <reference name="checkout.cart">
            <!--
            GravDept:
            Remove Magento's "top_methods" to prevent emphasized primary button from overpowering header.
            See: /checkout/cart.phtml
            -->
            <remove name="checkout.cart.top_methods" />

            <!-- GravDept: add custom "top_methods" block -->
            <block type="core/text_list" name="gravdept.checkout.cart.top_methods" as="gravdept_top_methods">
                <!-- GravDept: add custom sized button -->
                <block type="checkout/onepage_link" name="gravdept.checkout.onepage.link-top" template="gravdept/checkout/onepage/link-top.phtml" />
            </block>
        </reference>

        <reference name="before_body_end">
            <!-- GravDept -->
            <block type="core/template" name="gravdept.js.module-cart" after="-" template="gravdept/js/cart.phtml" />
        </reference>

        <!--
        GravDept:
        Hide PayPal Express checkout buttons.
        Users must complete normal OPC flow to select PayPal.
        -->
        <remove name="checkout.cart.methods.paypal_express.top" />
        <remove name="checkout.cart.methods.paypal_express.bottom" />
    </checkout_cart_index>

    <checkout_onepage_failure>
        <reference name="root">
            <!-- GravDept -->
            <action method="setTemplate">
                <template>page/1column.phtml</template>
            </action>
        </reference>
    </checkout_onepage_failure>

    <checkout_onepage_index>
        <reference name="root">
            <!-- GravDept -->
            <action method="setTemplate">
                <template>gravdept/page/checkout-onepage.phtml</template>
            </action>
        </reference>

        <reference name="head">
            <!--
            GravDept:
            Load generated script from Gulp.
            -->
            <action method="addItem">
                <type>skin_js</type>
                <name>js/build/module-checkout.min.js</name>
            </action>

            <!-- GravDept: remove unused scripts -->
            <action method="removeItem">
                <type>js</type>
                <name>mage/captcha.js</name>
            </action>

            <!-- GravDept: remove unused stylesheet -->
            <action method="removeItem">
                <type>js_css</type>
                <name>calendar/calendar-win2k-1.css</name>
            </action>

            <!-- GravDept: remove unused scripts -->
            <action method="removeItem">
                <type>js</type>
                <name>calendar/calendar.js</name>
            </action>

            <!-- GravDept: remove unused scripts -->
            <action method="removeItem">
                <type>js</type>
                <name>calendar/calendar-setup.js</name>
            </action>

            <!-- GravDept: loaded via Gulp -->
            <action method="removeItem">
                <type>js</type>
                <name>mage/directpost.js</name>
            </action>

            <!-- GravDept: loaded via Gulp -->
            <action method="removeItem">
                <type>js</type>
                <name>mage/centinel.js</name>
            </action>
        </reference>

        <reference name="checkout.onepage.payment">
            <!-- Add GravDept block -->
            <block type="core/template" name="gravdept.payment.icons" as="gravdept_payment_icons" template="gravdept/page/html/payment-icons.phtml" />
        </reference>
    </checkout_onepage_index>

    <checkout_onepage_success>
        <reference name="root">
            <!-- GravDept -->
            <action method="setTemplate">
                <template>page/1column.phtml</template>
            </action>
        </reference>
    </checkout_onepage_success>

    <cms_page>
        <reference name="cms.wrapper">
            <!--
            GravDept:
            Remove "std" value from being globally set on CMS Pages.
            Assign this manually per CMS Page content.
            -->
            <action method="setElementClass">
                <value></value>
            </action>
        </reference>
    </cms_page>

    <contacts_index_index>
        <reference name="head">
            <!-- GravDept -->
            <action method="setTitle" translate="title" module="contacts">
                <title>Contact Us</title>
            </action>
        </reference>

        <reference name="root">
            <!-- GravDept -->
            <action method="setTemplate"><template>page/1column.phtml</template></action>
        </reference>
    </contacts_index_index>

    <customer_account>
        <!-- GravDept: sales.xml -->
        <remove name="sale.reorder.sidebar" />
    </customer_account>

    <review_customer_index>
        <reference name="head">
            <!-- GravDept -->
            <action method="setHeaderTitle" translate="title" module="customer">
                <title>Your Reviews</title>
            </action>

            <!-- GravDept: fallback -->
            <!--
            <action method="setForcedTitle">
                <title>Your Reviews</title>
            </action>
            -->
        </reference>
    </review_customer_index>

    <sales_order_history>
        <reference name="head">
            <!-- GravDept -->
            <action method="setForcedTitle">
                <title>Your Orders</title>
            </action>
        </reference>

        <!-- GravDept: sales.xml -->
        <remove name="customer.account.link.back" />
    </sales_order_history>

    <sendfriend_product_send>
        <reference name="root">
            <!-- GravDept -->
            <action method="setTemplate"><template>page/1column.phtml</template></action>
        </reference>
    </sendfriend_product_send>

<!--
Base page layout handles
-->

    <page_empty>
        <reference name="head">
            <!-- Remove JS -->
            <action method="removeItem"><type>js</type><name>prototype/prototype.js</name></action>
            <action method="removeItem"><type>js</type><name>prototype/validation.js</name></action>
            <action method="removeItem"><type>js</type><name>varien/js.js</name></action>
            <action method="removeItem"><type>js</type><name>varien/form.js</name></action>
            <action method="removeItem"><type>js</type><name>mage/cookies.js</name></action>
        </reference>
    </page_empty>

<!--
GravDept page layout handles
-->

    <page_gravdept_account_dashboard translate="label">
        <label>Account Dashboard Layout Page</label>
        <reference name="root">
            <action method="setTemplate"><template>page/gravdept_account-dashboard.phtml</template></action>
            <!-- Mark root page block that template is applied -->
            <action method="setIsHandle"><applied>1</applied></action>
        </reference>
    </page_gravdept_account_dashboard>

    <page_gravdept_catalog_list translate="label">
        <label>Catalog List Layout Page</label>
        <reference name="root">
            <action method="setTemplate"><template>page/gravdept_catalog-list.phtml</template></action>
            <!-- Mark root page block that template is applied -->
            <action method="setIsHandle"><applied>1</applied></action>
        </reference>
    </page_gravdept_catalog_list>

    <page_gravdept_catalog_product translate="label">
        <label>Catalog Product Layout Page</label>
        <reference name="root">
            <action method="setTemplate"><template>page/gravdept_catalog-product.phtml</template></action>
            <!-- Mark root page block that template is applied -->
            <action method="setIsHandle"><applied>1</applied></action>
        </reference>
    </page_gravdept_catalog_product>

    <page_gravdept_checkout_multiship translate="label">
        <label>Checkout Multi-Shipping Layout Page</label>
        <reference name="root">
            <action method="setTemplate"><template>page/gravdept_checkout-multiship.phtml</template></action>
            <!-- Mark root page block that template is applied -->
            <action method="setIsHandle"><applied>1</applied></action>
        </reference>
    </page_gravdept_checkout_multiship>

    <page_gravdept_checkout_onepage translate="label">
        <label>Checkout Onepage Layout Page</label>
        <reference name="root">
            <action method="setTemplate"><template>page/gravdept_checkout-onepage.phtml</template></action>
            <!-- Mark root page block that template is applied -->
            <action method="setIsHandle"><applied>1</applied></action>
        </reference>
    </page_gravdept_checkout_onepage>

</layout>
